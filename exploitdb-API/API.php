<?php
require_once 'exploitdb.class.php';

header('Content-Type: application/json');

try {
    $db = new ExploitDB('./exploitdb/exploitdb.db');
    
    if (isset($_GET['CVE'])) {
        $result = $db->searchByCVE($_GET['CVE']);
        echo json_encode($result ? $result : ["error" => "No results found for the given CVE."]);
    } elseif (isset($_GET['title'])) {
        $result = $db->searchByTitle($_GET['title']);
        echo json_encode($result ? $result : ["error" => "No results found for the given title."]);
    } else {
        echo json_encode(["error" => "Invalid query. Use ?CVE or ?title"]);
    }
} catch (Exception $e) {
    echo json_encode(["error" => "Database error: " . $e->getMessage()]);
}
?>
?>